"use strict";(self.webpackChunkantd_pro_keepalive_tab=self.webpackChunkantd_pro_keepalive_tab||[]).push([[717],{11294:function(I,k,l){l.d(k,{O:function(){return r}});var A=l(50959),x={refreshTab:function(){},closeTab:function(){},closeOtherTab:function(){},onShow:function(){},onHidden:function(){}},r=(0,A.createContext)(x)},63786:function(I,k,l){l.r(k),l.d(k,{default:function(){return F}});var A=l(58048),x=l(9173),r=l(50959),s=l(48629),L=l(90967),R=l.n(L),M=l(30577),O=l.n(M);function K(){var P=(0,s.useSelectedRoutes)(),f=(0,s.useOutlet)(),u=(0,s.useAppData)(),v=u.routes,T=(0,s.useLocation)(),m=T.pathname,a=(0,s.useIntl)(),E=a.formatMessage,d=(0,r.useState)(),c=O()(d,2),o=c[0],S=c[1],y=function(h){for(var i=h.route,t=["menu"];i.parentId&&!i.isLayout&&v[i.parentId].name;){t.push(v[i.parentId].name);i=v[i.parentId]}return t.push(h.route.name),E({id:t.join(".")})};return(0,r.useEffect)(function(){var p,h=P.at(-1);if(h!=null&&(p=h.route)!==null&&p!==void 0&&p.path){var i=v[h.route.id];if(i!=null&&i.redirect){s.history.replace(i==null?void 0:i.redirect);return}var t=y(h);S({title:t,pathname:m,children:f,routePath:h.route.path,icon:h.route.icon})}},[m]),o}function H(){return new Date().getTime().toString()}function j(){var P=(0,r.useState)([]),f=O()(P,2),u=f[0],v=f[1],T=(0,r.useState)(""),m=O()(T,2),a=m[0],E=m[1],d=(0,r.useRef)({}),c=(0,r.useRef)({}),o=K(),S=(0,r.useCallback)(function(t){d.current[a]||(d.current[a]=[]),d.current[a].push(t)},[a]),y=(0,r.useCallback)(function(t){c.current[a]||(c.current[a]=[]),c.current[a].push(t)},[a]),p=(0,r.useCallback)(function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:a,e=u.findIndex(function(n){return n.routePath===t});u[e].routePath===a&&(e>0?s.history.push(u[e-1].routePath):s.history.push(u[e+1].routePath)),u.splice(e,1),delete c.current[t],delete d.current[t],v(R()(u))},[a]),h=(0,r.useCallback)(function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:a,e=u.filter(function(n){return n.routePath!==t});e.forEach(function(n){delete c.current[n.routePath],delete d.current[n.routePath]}),v(function(n){return n.filter(function(g){return g.routePath===t})})},[a]),i=(0,r.useCallback)(function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:a;v(function(e){var n=e.findIndex(function(g){return g.routePath===t});return n>=0&&(e[n].key=H()),delete c.current[e[n].routePath],delete d.current[e[n].routePath],R()(e)})},[a]);return(0,r.useEffect)(function(){if(o){var t=u.find(function(e){return e.routePath===(o==null?void 0:o.routePath)});E(o.routePath),t?t.pathname!==o.pathname?v(function(e){var n=e.findIndex(function(g){return g.routePath===o.routePath});return n>=0&&(e[n].key=H(),e[n].pathname=o.pathname,e[n].children=o.children),delete c.current[e[n].routePath],delete d.current[e[n].routePath],R()(e)}):(d.current[t.routePath]||[]).forEach(function(e){e()}):v(function(e){return[].concat(R()(e),[{title:o.title,key:H(),routePath:o.routePath,pathname:o.pathname,children:o.children,icon:o.icon}])}),(c.current[a]||[]).forEach(function(e){e()})}},[o]),{keepAliveTabs:u,activeTabRoutePath:a,closeTab:p,refreshTab:i,closeOtherTab:h,onShow:S,onHidden:y}}var D=l(11294),C=l(11527),b;(function(P){P.REFRESH="refresh",P.CLOSE="close",P.CLOSEOTHER="close-other"})(b||(b={}));var w=function(){var f=j(),u=f.keepAliveTabs,v=f.activeTabRoutePath,T=f.closeTab,m=f.refreshTab,a=f.closeOtherTab,E=f.onHidden,d=f.onShow,c=(0,r.useMemo)(function(){return[{label:"\u5237\u65B0",key:b.REFRESH},u.length<=1?null:{label:"\u5173\u95ED",key:b.CLOSE},u.length<=1?null:{label:"\u5173\u95ED\u5176\u4ED6",key:b.CLOSEOTHER}].filter(function(t){return t})},[u]),o=(0,r.useCallback)(function(t,e){var n=t.key,g=t.domEvent;g.stopPropagation(),n===b.REFRESH?m(e.routePath):n===b.CLOSE?T(e.routePath):n===b.CLOSEOTHER&&a(e.routePath)},[a,T,m]),S=(0,r.useCallback)(function(t){return(0,C.jsx)(A.Z,{menu:{items:c,onClick:function(n){return o(n,t)}},trigger:["contextMenu"],children:(0,C.jsxs)("div",{style:{margin:"-12px 0",padding:"12px 0"},children:[t.icon,t.title]})})},[c]),y=(0,r.useMemo)(function(){return u.map(function(t){return{key:t.routePath,label:S(t),children:(0,C.jsx)("div",{style:{height:"calc(100vh - 112px)",overflow:"auto"},children:t.children},t.key),closable:u.length>1}})},[u]),p=(0,r.useCallback)(function(t){var e=u.find(function(n){return n.routePath===t});e&&s.history.push(e==null?void 0:e.pathname)},[u]),h=function(e,n){n==="remove"&&T(e)},i=(0,r.useMemo)(function(){return{closeTab:T,closeOtherTab:a,refreshTab:m,onHidden:E,onShow:d}},[T,a,m,E,d]);return(0,C.jsx)(D.O.Provider,{value:i,children:(0,C.jsx)(x.Z,{type:"editable-card",items:y,activeKey:v,onChange:p,className:"keep-alive-tabs",hideAdd:!0,animated:!1,onEdit:h})})},F=w}}]);
